{"md5":"853a64ccf46bd8e18865d19addd5c557","content":"\n\n\n<div id=\"outline-container-sec-1\" class=\"outline-2\">\n<h2 id=\"sec-1\">&#x5B89;&#x88C5; LogService Fluentd</h2>\n<div class=\"outline-text-2\" id=\"text-1\">\n<p>\n&#x76EE;&#x524D; LogService Fluentd &#x5728;&#x539F;&#x6709;&#x57FA;&#x7840;&#x4E0A;&#x5C01;&#x88C5;&#x4E86; LogService &#x7684;&#x63D2;&#x4EF6;&#xFF0C;&#x5E73;&#x53F0;&#x63D0;&#x4F9B; tar &#x5305;&#x7684;&#x4E0B;&#x8F7D;&#x5730;&#x5740;&#xFF0C;&#x5177;&#x4F53;&#x65B9;&#x5F0F;&#x89C1;&#x4E0B;:\n</p>\n</div>\n<div id=\"outline-container-sec-1-1\" class=\"outline-3\">\n<h3 id=\"sec-1-1\">&#x4E0B;&#x8F7D;</h3>\n<div class=\"outline-text-3\" id=\"text-1-1\">\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">wget http://kmr-sh-hdp.ks3-cn-shanghai.ksyun.com/KSCLogService/fluentd.tar.gz -O /opt/fluentd.tar.gz</span><br></pre></td></tr></table></figure>\n</div>\n<p>\n&#x6CE8;: &#x56E0; fluentd &#x4E2D;&#x90E8;&#x5206;&#x4EE3;&#x7801;&#x4F7F;&#x7528;&#x8DEF;&#x5F84;&#x5747;&#x4E3A; /opt, &#x6545; fluentd &#x9700;&#x90E8;&#x7F72;&#x5728; /opt &#x76EE;&#x5F55;&#x4E0B;\n</p>\n</div>\n</div>\n<div id=\"outline-container-sec-1-2\" class=\"outline-3\">\n<h3 id=\"sec-1-2\">&#x89E3;&#x538B;</h3>\n<div class=\"outline-text-3\" id=\"text-1-2\">\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /opt &amp;&amp; tar zxvf fluentd.tar.gz</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-2\" class=\"outline-2\">\n<h2 id=\"sec-2\">&#x914D;&#x7F6E;&#x8BF4;&#x660E;</h2>\n<div class=\"outline-text-2\" id=\"text-2\">\n<p>\n&#x6309;&#x7167;&#x4E0A;&#x8FF0;&#x5B89;&#x88C5;&#x6B65;&#x9AA4;&#xFF0C; Fluentd &#x7684;&#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x90E8;&#x7F72;&#x8DEF;&#x5F84;&#x4E3A; /opt/td-agent/etc/fluentd/fluent.conf\n</p>\n</div>\n<div id=\"outline-container-sec-2-1\" class=\"outline-3\">\n<h3 id=\"sec-2-1\">Fluentd &#x914D;&#x7F6E;&#x8BF4;&#x660E;</h3>\n<div class=\"outline-text-3\" id=\"text-2-1\">\n<p>\nFluentd &#x5305;&#x542B;&#x4EE5;&#x4E0B;&#x914D;&#x7F6E;&#x5B57;&#x6BB5;&#xFF1A;\n</p>\n<p class=\"verse\">\n<b>source</b> &#x8BBE;&#x7F6E;&#x6570;&#x636E;&#x6E90;<br>\n<b>match</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;<br>\n<b>filter</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x524D;&#x7684;&#x5904;&#x7406;&#x903B;&#x8F91;<br>\n<b>system</b> &#x8BBE;&#x7F6E;&#x7CFB;&#x7EDF;&#x7EA7;&#x522B;&#x914D;&#x7F6E;<br>\n<b>label</b><br>\n<b>@include</b> &#x5305;&#x542B;&#x5176;&#x4ED6;&#x53EF;&#x91CD;&#x7528;&#x6587;&#x4EF6;<br>\n</p>\n<p>\n&#x5229;&#x7528; <b>source</b> &#x548C; <b>match</b> &#x5373;&#x53EF;&#x914D;&#x7F6E;&#x4E00;&#x4E2A;&#x7B80;&#x5355;&#x7684;&#x5B9E;&#x4F8B;&#xFF0C;&#x672C;&#x6587;&#x6863;&#x7740;&#x91CD;&#x8FD9;&#x4E24;&#x4E2A;&#x6807;&#x7B7E;\n</p>\n</div>\n<div id=\"outline-container-sec-2-1-1\" class=\"outline-4\">\n<h4 id=\"sec-2-1-1\"><b>source</b> &#x6570;&#x636E;&#x4ECE;&#x54EA;&#x6765;</h4>\n<div class=\"outline-text-4\" id=\"text-2-1-1\">\n<p>\n<b>source</b> &#x914D;&#x7F6E;&#x9879;&#x89C1;&#x4E0B;:\n</p>\n</div>\n<ul class=\"org-ul\"><li><a id=\"sec-2-1-1-1\" name=\"sec-2-1-1-1\"></a><b>@type</b> &#x8BBE;&#x7F6E;&#x8F93;&#x5165;&#x6E90;&#x4F7F;&#x7528;&#x7684; plugin<br><div class=\"outline-text-5\" id=\"text-2-1-1-1\">\n<p>\ninput plugin @type &#x652F;&#x6301; <i>http</i> &#x548C; <i>forward</i> &#x7B49;. <i>http</i> &#x7528;&#x4E8E;&#x63A5;&#x6536; HTTP &#x534F;&#x8BAE;&#x6570;&#x636E;, <i>forward</i>  &#x7528;&#x4E8E;&#x63A5;&#x6536; TCP &#x534F;&#x8BAE;&#x6570;&#x636E;&#xFF0C;&#x5177;&#x4F53;&#x914D;&#x7F6E;&#x89C1;&#x4E0B;:\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\"># Receive events from 24224/tcp\n# This is used by log forwarding and the fluent-cat command\n&lt;source&gt;\n  @type forward\n  port 24224\n&lt;/source&gt;\n\n# http://this.host:9880/myapp.access?json={&quot;event&quot;:&quot;data&quot;}\n&lt;source&gt;\n  @type http\n  port 9880\n&lt;/source&gt;</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n<ul class=\"org-ul\"><li><a id=\"sec-2-1-1-1-0-1\" name=\"sec-2-1-1-1-0-1\"></a>Fluentd &#x652F;&#x6301;&#x540C;&#x65F6;&#x914D;&#x7F6E;&#x591A;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#xFF0C;&#x6240;&#x4EE5;&#x53EF;&#x4EE5;&#x6839;&#x636E;&#x9700;&#x6C42;&#x914D;&#x7F6E;&#x4E0D;&#x540C;&#x7684;&#x8F93;&#x5165; type<br></li>\n<li><a id=\"sec-2-1-1-1-0-2\" name=\"sec-2-1-1-1-0-2\"></a>&#x6BCF;&#x4E00;&#x4E2A;&#x8F93;&#x5165;&#x6E90;&#x5FC5;&#x987B;&#x6307;&#x660E;&#x8F93;&#x5165; type&#xFF0C;@type &#x914D;&#x7F6E;&#x9879;&#x8BBE;&#x5B9A;&#x4E86;&#x9700;&#x8981;&#x4F7F;&#x7528;&#x7684; plugin&#xFF0C;&#x9664; <i>http</i> &#x548C; <i>forward</i> &#x5916;&#xFF0C;&#x5176;&#x4ED6;&#x8FD8;&#x7ECF;&#x5E38;&#x7528;&#x7684; input plugin &#x6709; tail&#x3001;syslog&#x3001;scribe&#xFF0C;&#x5168;&#x90E8; input plugin &#x4EE5;&#x53CA;&#x4F7F;&#x7528;&#x573A;&#x666F;&#x8BF7;&#x53C2;&#x89C1;&#xFF1A;<a href=\"http://docs.fluentd.org/articles/input-plugin-overview\">Input Plugin Overview</a><br></li></ul>\n</li>\n\n<li><a id=\"sec-2-1-1-2\" name=\"sec-2-1-1-2\"></a><b>tag</b> &#x8BBE;&#x7F6E;&#x4E8B;&#x4EF6;&#x7684;&#x6807;&#x7B7E;<br><div class=\"outline-text-5\" id=\"text-2-1-1-2\">\n<p>\n&#x5728;&#x8BBE;&#x7F6E;&#x8F93;&#x5165;&#x6E90;&#x4E2D;&#xFF0C;&#x4E3A;&#x4E86;&#x540E;&#x7EED; output plugin &#x80FD;&#x591F;&#x8BC6;&#x522B;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#xFF0C;&#x9700;&#x8BBE;&#x7F6E; <i>tag</i> &#x5B57;&#x6BB5;, &#x5177;&#x4F53;&#x89C1; match &#x90E8;&#x5206;\n</p>\n</div>\n</li></ul>\n</div>\n<div id=\"outline-container-sec-2-1-2\" class=\"outline-4\">\n<h4 id=\"sec-2-1-2\"><b>match</b> &#x6570;&#x636E;&#x5230;&#x54EA;&#x53BB;</h4>\n<div class=\"outline-text-4\" id=\"text-2-1-2\">\n<p>\n<b>match</b> &#x914D;&#x7F6E;&#x9879;&#x89C1;&#x4E0B;:\n</p>\n</div>\n<ul class=\"org-ul\"><li><a id=\"sec-2-1-2-1\" name=\"sec-2-1-2-1\"></a><b>match pattern</b><br><div class=\"outline-text-5\" id=\"text-2-1-2-1\">\n<p>\nmatch pattern &#x901A;&#x8FC7; tag &#x6765;&#x8BC6;&#x522B;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E;&#xFF0C;match tag &#x4F1A;&#x5339;&#x914D; <b>source</b>  &#x4E2D; <i>tag</i>  &#x5B57;&#x6BB5;&#x6765;&#x786E;&#x5B9A;&#x8981;&#x5904;&#x7406;&#x7684;&#x6570;&#x636E; \n</p>\n</div>\n</li>\n<li><a id=\"sec-2-1-2-2\" name=\"sec-2-1-2-2\"></a><b>@type</b> &#x8BBE;&#x7F6E;&#x8F93;&#x51FA;&#x6E90;&#x4F7F;&#x7528;&#x7684; plugin<br><div class=\"outline-text-5\" id=\"text-2-1-2-2\">\n<p>\noutput plugin <b>@type</b> &#x652F;&#x6301; <i>file</i> &#x548C; <i>forward</i>  &#x7B49;. <i>file</i> &#x5C06;&#x63A5;&#x6536;&#x5230;&#x7684;&#x6570;&#x636E;&#x5199;&#x5165;&#x5230;&#x672C;&#x5730;&#x6587;&#x4EF6;&#x4E2D;, <i>forward</i> &#x540C;&#x4E0A;&#x5C06;&#x6570;&#x636E;&#x53D1;&#x9001;&#x5230; TCP &#x534F;&#x8BAE;. \n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;source&gt;\n  @type http\n  port 9880\n  tag myapp.access\n&lt;/source&gt;\n\n# Match events tagged with &quot;myapp.access&quot; and\n# store them to /var/log/fluent/access.%Y-%m-%d\n# Of course, you can control how you partition your data\n# with the time_slice_format option.\n&lt;match myapp.access&gt;\n  @type file\n  path /var/log/fluent/access\n&lt;/match&gt;</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n</li>\n<li><a id=\"sec-2-1-2-3\" name=\"sec-2-1-2-3\"></a>LogService output plugin<br><div class=\"outline-text-5\" id=\"text-2-1-2-3\">\n<p>\nFluentd &#x53D1;&#x9001;&#x6570;&#x636E;&#x5230; LogService &#x4F7F;&#x7528;&#x7684;&#x81EA;&#x5B9A;&#x4E49;&#x7684; plugin: ksy, &#x5177;&#x4F53;&#x914D;&#x7F6E;&#x89C1;&#x4E0B;:\n</p>\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">&lt;match test&gt; #&#x5339;&#x914D;test\n  @type ksy  #&#x5339;&#x914D;&#x8F93;&#x51FA;&#x7C7B;&#x578B; &#x8FD9;&#x91CC;&#x662F;&#x5F00;&#x53D1;&#x7684;&#x4E00;&#x4E2A;&#x8F93;&#x51FA;&#x63D2;&#x4EF6;\n  log_service_addr http://10.111.0.41:28888 #&#x5730;&#x5740;\n  access_key_id  #ak\n  access_key_secret #sk\n  Logstore #&#x65E5;&#x5FD7;&#x5E93;\n  path /path/to/cache  #&#x7F13;&#x5B58;&#x8DEF;&#x5F84;\n&lt;/match&gt;</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n</li></ul>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-3\" class=\"outline-2\">\n<h2 id=\"sec-3\">&#x542F;&#x505C; Fluentd</h2>\n<div class=\"outline-text-2\" id=\"text-3\">\n</div><div id=\"outline-container-sec-3-1\" class=\"outline-3\">\n<h3 id=\"sec-3-1\">&#x542F;&#x52A8; Fluentd</h3>\n<div class=\"outline-text-3\" id=\"text-3-1\">\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /opt/td-agent &amp;&amp; sh start_fluentd.sh</span><br></pre></td></tr></table></figure>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-3-2\" class=\"outline-3\">\n<h3 id=\"sec-3-2\">&#x505C;&#x6B62; Fluentd</h3>\n<div class=\"outline-text-3\" id=\"text-3-2\">\n<div class=\"org-src-container\">\n\n<figure class=\"highlight\"><table><tr><td class=\"code\"><pre><span class=\"line\">cd /opt/td-agent &amp;&amp; sh stop_fluentd.sh</span><br></pre></td></tr></table></figure>\n</div>\n<p>\n&#x542F;&#x52A8;&#x540E;&#xFF0C;Fluentd &#x65E5;&#x5FD7;&#x5C06;&#x4F1A;&#x5199;&#x5165; /var/log/fluentd/fluentd.log (&#x542F;&#x52A8;&#x65F6;&#x8BF7;&#x4F7F;&#x7528; root &#x6743;&#x9650;)\n</p>\n</div>\n</div>\n</div>\n<div id=\"outline-container-sec-4\" class=\"outline-2\">\n<h2 id=\"sec-4\">&#x5B98;&#x65B9;&#x6587;&#x6863;</h2>\n<div class=\"outline-text-2\" id=\"text-4\">\n</div><div id=\"outline-container-sec-4-1\" class=\"outline-3\">\n<h3 id=\"sec-4-1\">Fluentd : <a href=\"http://www.fluentd.org/\">Fluentd</a></h3>\n</div>\n<div id=\"outline-container-sec-4-2\" class=\"outline-3\">\n<h3 id=\"sec-4-2\">Fluentd &#x914D;&#x7F6E;&#x6587;&#x4EF6;&#x8BF4;&#x660E;&#x8BF7;&#x53C2;&#x89C1;: <a href=\"http://docs.fluentd.org/articles/config-file\">Fluentd Configure</a></h3>\n</div>\n</div>\n"}
